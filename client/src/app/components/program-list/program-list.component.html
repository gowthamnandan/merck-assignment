  <div>
      <!-- Header -->
      <div class="d-flex flex-column flex-sm-row justify-content-between align-items-sm-center gap-2 mb-4">
        <div>
          <h2 class="mb-1">Programs</h2>
          <p class="text-body-secondary mb-0">{{ total() }} programs found</p>
        </div>
      </div>

      <!-- Filters -->
      <c-card class="mb-4">
        <c-card-body>
          <c-row class="g-3">
            <!-- Search -->
            <c-col lg="4">
              <c-input-group>
                <span cInputGroupText>
                  <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                </span>
                <input cFormControl type="text" [(ngModel)]="search" (ngModelChange)="onFilterChange()"
                       placeholder="Search programs, codes, indications..." />
              </c-input-group>
            </c-col>
            <!-- Phase -->
            <c-col sm="6" lg="3">
              <select cFormSelect [(ngModel)]="filterPhase" (ngModelChange)="onFilterChange()">
                <option value="">All Phases</option>
                @for (p of filters()?.phases || []; track p) {
                  <option [value]="p">{{ p }}</option>
                }
              </select>
            </c-col>
            <!-- Therapeutic Area -->
            <c-col sm="6" lg="3">
              <select cFormSelect [(ngModel)]="filterArea" (ngModelChange)="onFilterChange()">
                <option value="">All Therapeutic Areas</option>
                @for (a of filters()?.therapeutic_areas || []; track a) {
                  <option [value]="a">{{ a }}</option>
                }
              </select>
            </c-col>
            <!-- Status -->
            <c-col sm="6" lg="2">
              <select cFormSelect [(ngModel)]="filterStatus" (ngModelChange)="onFilterChange()">
                <option value="">All Statuses</option>
                @for (s of filters()?.statuses || []; track s) {
                  <option [value]="s">{{ s }}</option>
                }
              </select>
            </c-col>
          </c-row>

          @if (hasActiveFilters()) {
            <div class="mt-3 d-flex align-items-center gap-2 flex-wrap">
              <small class="text-body-secondary">Active filters:</small>
              @if (filterPhase) {
                <c-badge color="primary" class="d-inline-flex align-items-center gap-1">
                  {{ filterPhase }}
                  <button class="btn-close btn-close-white ms-1" style="font-size: .5rem;" (click)="filterPhase = ''; onFilterChange()"></button>
                </c-badge>
              }
              @if (filterArea) {
                <c-badge color="info" class="d-inline-flex align-items-center gap-1">
                  {{ filterArea }}
                  <button class="btn-close btn-close-white ms-1" style="font-size: .5rem;" (click)="filterArea = ''; onFilterChange()"></button>
                </c-badge>
              }
              @if (filterStatus) {
                <c-badge color="success" class="d-inline-flex align-items-center gap-1">
                  {{ filterStatus }}
                  <button class="btn-close btn-close-white ms-1" style="font-size: .5rem;" (click)="filterStatus = ''; onFilterChange()"></button>
                </c-badge>
              }
              <button cButton color="link" size="sm" class="text-danger p-0" (click)="clearFilters()">Clear all</button>
            </div>
          }
        </c-card-body>
      </c-card>

      <!-- Loading -->
      @if (loading()) {
        <div class="d-flex justify-content-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      } @else {
        <!-- Programs Grid -->
        <c-row class="mb-4">
          @for (program of programs(); track program.id) {
            <c-col md="6" xl="4" class="mb-4">
              <c-card class="h-100 card-hover" style="cursor: pointer;" [routerLink]="['/programs', program.id]">
                <c-card-body>
                  <!-- Header -->
                  <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="flex-grow-1 overflow-hidden">
                      <small class="text-body-secondary font-monospace">{{ program.code }}</small>
                      <h6 class="mb-0 mt-1 text-truncate-2">{{ program.name }}</h6>
                    </div>
                    <c-badge [color]="getPhaseColor(program.phase)" class="ms-2 text-nowrap">{{ program.phase }}</c-badge>
                  </div>

                  <!-- Meta -->
                  <div class="mb-3">
                    <div class="d-flex align-items-center gap-2 text-body-secondary small mb-1">
                      <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A2 2 0 013 12V7a4 4 0 014-4z"/>
                      </svg>
                      {{ program.therapeutic_area }}
                    </div>
                    <div class="d-flex align-items-center gap-2 text-body-secondary small">
                      <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                      </svg>
                      {{ program.indication }}
                    </div>
                  </div>

                  <!-- Stats -->
                  <div class="d-flex align-items-center gap-3 pt-3 border-top">
                    <c-badge [color]="getStatusColor(program.status)">{{ program.status }}</c-badge>
                    <small class="text-body-secondary">{{ program.study_count }} studies</small>
                    @if (program.target_enrollment > 0) {
                      <small class="text-body-secondary">
                        {{ program.total_enrollment | number }}/{{ program.target_enrollment | number }} enrolled
                      </small>
                    }
                  </div>

                  <!-- Milestone progress -->
                  @if (program.milestone_count > 0) {
                    <div class="mt-3">
                      <div class="d-flex justify-content-between small text-body-secondary mb-1">
                        <span>Milestones</span>
                        <span>{{ program.completed_milestones }}/{{ program.milestone_count }}</span>
                      </div>
                      <c-progress [value]="(program.completed_milestones / program.milestone_count) * 100"
                                  color="primary" style="height: 6px;"></c-progress>
                    </div>
                  }
                </c-card-body>
              </c-card>
            </c-col>
          }
        </c-row>

        <!-- Empty state -->
        @if (programs().length === 0) {
          <div class="text-center py-5">
            <svg class="mb-3" width="64" height="64" fill="none" stroke="var(--cui-secondary-color)" viewBox="0 0 24 24" style="opacity:.4">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <p class="fs-5 text-body-secondary">No programs found</p>
            <p class="text-body-secondary small">Try adjusting your filters</p>
          </div>
        }

        <!-- Pagination -->
        @if (totalPages() > 1) {
          <c-card>
            <c-card-body class="d-flex justify-content-between align-items-center">
              <small class="text-body-secondary">
                Showing {{ ((currentPage() - 1) * pageSize) + 1 }}â€“{{ Math.min(currentPage() * pageSize, total()) }} of {{ total() }}
              </small>
              <c-pagination>
                <c-page-item [disabled]="currentPage() <= 1">
                  <a cPageLink (click)="goToPage(currentPage() - 1)">Previous</a>
                </c-page-item>
                @for (p of visiblePages(); track p) {
                  <c-page-item [active]="p === currentPage()">
                    <a cPageLink (click)="goToPage(p)">{{ p }}</a>
                  </c-page-item>
                }
                <c-page-item [disabled]="currentPage() >= totalPages()">
                  <a cPageLink (click)="goToPage(currentPage() + 1)">Next</a>
                </c-page-item>
              </c-pagination>
            </c-card-body>
          </c-card>
        }
      }
    </div>